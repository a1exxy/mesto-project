(()=>{"use strict";var e=function(e){"Escape"===e.code&&t(document.querySelector(".popup_opened"))},t=function(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",e);var n=new Event("cancel",{bubbles:!0});t.dispatchEvent(n)},n=function(t){t.classList.add("popup_opened"),document.addEventListener("keydown",e)},o={baseUrl:"https://nomoreparties.co/v1/plus-cohort-22",headers:{authorization:"e946af28-6776-4621-8721-b1a2f230a011","Content-Type":"application/json"}},r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c={method:t,headers:o.headers};return n&&["POST","PATCH"].includes(t)&&(c.body=JSON.stringify(n)),r&&console.log("Run sendRequest(\n\nURL:".concat(o.baseUrl+e,",\nMETHOD:").concat(t,",\nBODY:").concat(n,",\n\n)")),fetch(o.baseUrl+e,c).then((function(e){return e.ok?e.json():Promise.reject("Ошибка сетевого взаимодействия: ".concat(e.status))}))},c=function(e){return r("/cards/likes/".concat(e),"PUT")},u=function(e){return r("/cards/likes/".concat(e),"DELETE")},i=document.querySelector(".newplace-form"),a=document.querySelector(".profile__add-button"),l=document.querySelector(".popup-newplace"),s=document.querySelector(".newPlaceName"),d=document.querySelector(".newPlaceURL"),f=document.querySelector(".elements"),p=document.querySelector(".element-template").content,m=document.querySelector(".popup-img"),v=m.querySelector(".popup__caption"),y=m.querySelector(".popup__view"),_=document.querySelector(".popup-confirm"),S=_.querySelector(".confirm-form"),h=null,b=null,q=function(e){var n;e.preventDefault(),(n=b,r("/cards/".concat(n),"DELETE")).then((function(){h.remove(),t(_)})).catch((function(e){return console.log("Ошибка удаления карточки: ".concat(e))}))};function L(e,t,o,r,i,a){var l=p.querySelector(".element").cloneNode(!0),s=l.querySelector(".element__img"),d=l.querySelector(".element__trash"),f=l.querySelector(".element__likes-count"),L=l.querySelector(".element__link");return f.textContent=a.length,a.forEach((function(e){e._id===r&&L.classList.add("element__link_active")})),s.src=t,s.alt="Изображение "+e,l.querySelector(".element__title").textContent=e,l.querySelector(".element__link").addEventListener("click",(function(e){e.target.classList.contains("element__link_active")?u(i).then((function(){e.target.classList.toggle("element__link_active"),f.textContent=Number(f.textContent)-1})).catch((function(e){return console.log("Ошибка удаления лайка: ".concat(e))})):c(i).then((function(){e.target.classList.toggle("element__link_active"),f.textContent=Number(f.textContent)+1})).catch((function(e){return console.log("Ошибка добавления лайка: ".concat(e))}))})),o===r?d.addEventListener("click",(function(){h=l,b=i,n(_),S.addEventListener("submit",q,{once:!0})})):d.hidden=!0,l.querySelector(".element__show").addEventListener("click",(function(){v.textContent=e,y.alt="Изображение "+e,y.src=t,n(m)})),l}function g(e,t){e.disabled=!0,e.classList.add(t)}function E(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?function(e,t){e.disabled=!1,e.classList.remove(t)}(t,n):g(t,n)}function C(e,t,n,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o),r.textContent=""}(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),c.classList.add(r),c.textContent=n}(e,t,t.validationMessage,n,o)}document.addEventListener("cancel",(function(e){e.target.classList.contains("popup-confirm")&&S.removeEventListener("submit",q)}));var k="popup__save-button_deactivate",x="popup__text-input_invalid",w="popup__text-input-error_active",A=".popup__inputs",P=".popup__text-input",T=".popup__save-button",O=document.querySelector(".popup-editprofile"),j=document.querySelector(".profile__edit-button"),D=document.querySelector(".profile-editor"),U=document.querySelector(".editProfileName"),M=document.querySelector(".editProfileAboutMe"),N=document.querySelector(".profile__name"),H=document.querySelector(".profile__about-me"),I=document.querySelector(".profile__avatar"),R=I.querySelector(".profile__avatar-btn"),V=document.querySelector(".popup-avatar"),z=V.querySelector(".avatarLink"),B=V.querySelector(".avatar-form"),G=function(){U.value=N.textContent,M.value=H.textContent},J=function(e){N.textContent=e.name,H.textContent=e.about},Y=function(e){I.style.backgroundImage="url('".concat(e.avatar,"')")};function $(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(n){(n.target.classList.contains("popup_opened")||n.target.classList.contains("popup__close-button"))&&t(e)}))})),Promise.all([r("/users/me"),r("/cards").then((function(e){return e}))]).then((function(e){var o,c,u,p,m,v,y,_,S,h,b=(h=2,function(e){if(Array.isArray(e))return e}(S=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c,u,i=[],a=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;a=!1}else for(;!(a=(o=c.call(n)).done)&&(i.push(o.value),i.length!==t);a=!0);}catch(e){l=!0,r=e}finally{try{if(!a&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw r}}return i}}(S,h)||function(e,t){if(e){if("string"==typeof e)return $(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$(e,t):void 0}}(S,h)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),q=b[0],N=b[1];J(o=q),Y(o),G(),j.addEventListener("click",(function(){G(),n(O),function(e,t,n,o){var r=document.querySelector(e);r.querySelectorAll(t).forEach((function(e){C(r,e,n,o)}))}(".profile-editor",P,x,w)})),D.addEventListener("submit",(function(e){var n,o;e.preventDefault(),e.submitter.textContent="Сохранение...",(n=U.value,o=M.value,r("/users/me","PATCH",{name:n,about:o})).then((function(e){J(e),t(O)})).catch((function(e){return console.log("Ошибка сохранения профайла: ".concat(e))})).finally((function(){return e.submitter.textContent="Сохранить"}))})),R.addEventListener("click",(function(){n(V)})),B.addEventListener("submit",(function(e){var n;e.preventDefault(),e.submitter.textContent="Сохранение...",(n=z.value,r("/users/me/avatar","PATCH",{avatar:n})).then((function(e){Y(e),t(V)})).catch((function(e){return console.log("Ошибка сохранения аватара: ".concat(e))})).finally((function(){return e.submitter.textContent="Сохранить"}))})),c=A,u=P,p=T,m=k,v=x,y=w,document.querySelectorAll(c).forEach((function(e){var t=e.querySelector(p),n=Array.from(e.querySelectorAll(u));n.forEach((function(t){t.addEventListener("input",(function(){C(e,t,v,y)}))})),E(n,t,m),e.addEventListener("input",(function(){E(n,t,m)})),e.addEventListener("reset",(function(){g(t,m)}))})),function(e,t){e.forEach((function(e){f.append(L(e.name,e.link,e.owner._id,t,e._id,e.likes))}))}(N,q._id),_=q._id,a.addEventListener("click",(function(){n(l)})),i.addEventListener("submit",(function(e){var n,o;e.preventDefault(),e.submitter.textContent="Сохранение...",(n=s.value,o=d.value,r("/cards","POST",{name:n,link:o})).then((function(n){f.prepend(L(n.name,n.link,n.owner._id,_,n._id,n.likes)),e.target.reset(),t(l)})).catch((function(e){return console.log("Ошибка добовления карточки: ".concat(e))})).finally((function(){return e.submitter.textContent="Сохранить"}))}))})).catch((function(e){return console.log("Ошибка загрузки данных: ".concat(e))}))})();